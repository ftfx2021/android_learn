# 发送
## 扩展BaseCommands.java 
它的接口为CommandsInterfance
frameworks/opt/telephony/src/java/com/android/internal/telephony/**BaseCommands.java**
RIL继承该类，接口也为CommandsInterfance
用于定义一些基本的命令或者通信接口
- 1、在BaseCommands添加方法setValueToModem  子类去重写
- 2、RILConstant.java添加消息  int RIL_REQUEST_VALUE = 200;
- 3、在RIL.java重写setValueToModem（）方法、
  + RILRequest rr = RILRequest.obtain(...)
  + rr.mParcel.writeInt(...)
  + if()  ...">"...
  + send(rr)
 
## 扩展PhoneInternalInterface接口

  主要为了封装RILJ的方法，Phone实现它，得到Phone，就能调用RIL方法
  
- 扩展PhoneInternalInterface接口：加方法setValueToModem()
- Phone实现方法
  +public CommandsInterface mCi;
  + setValueToModem(...){... mCi.setValueToModem(...)  }
 
## 扩展ITelephony接口
ITelephony接口封装了Phone中的方法

- 在ITelephony新增方法setValueToModem(...)
- 在PhoneInterfaceManager.java实现它
  + Phone phone = PhoneFactory.getDefaultPhone()
  + phone.setValueToModem(...)
- 为了让PhoneInterfaceManager在不运行在Phone进程的类使用它，在TelephoneManager进一步封装该方法
  + ITelephony telephony = getITelephony()
  + telephony.setValueToModem(...)
 
## 流程梳理
CommandsInterfance --> BaseCommands -> RIL ,PhoneInternalInterface --> Phone (commandsInterfance.setValueToModem) ,  ITelephony --> PhoneInterfaceManager (phone.setValueToModem), TelephoneManager(telephony.setValueToModem)

```
app -> TelephonyManager -> TelephonyRegister ->Phone ->RIL
```


# 返回结果
## RILJ处理(新)
- processResponseInternal的switch增加 case RIL_REQUEST_VALUE :...
- 在retToString增加 case RIL_REQUEST_VALUE:return "RIL_REQUEST_VALUE"
## Phone处理
 - 定义回调消息
   + EVENT_SET_VALUE_DONE 200
   + EVENT_LAST RIL_REQUEST_VALUE
  - handleMessage方法增加switch分支
    + case EVENT_SET_VALUE_DONE:通过广播或Notifier通知APP
## 扩展PhoneNotifier接口
为了进一步上报消息并且附带结果
实现类：DefaultPhoneNotifier.java
 -  PhoneNotifier.java新增方法 notifySetValueDone(res)
 -  DefaultPhoneNotifier实现
   +  private TelephonyRegistryManager mTelephonyRegistryMgr
   +  mTelephonyRegistryMgr.nofifySetValueDone
## 扩展ITelephoneRegistry接口
- ITelephoneRegistry接口增加方法notifySetValueDone(res)
- 在它的实现类TelephoneRegistry.java实现该接口
  + for(Record r: mRecords){r.callback.onSetValueDone(res)}
- 

